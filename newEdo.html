

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="newEdo.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400..900&display=swap" rel="stylesheet">

<main class="main-container">
    <header class="sheet-header">
        <div class="newedo-logo-svg"></div>
    </header>

    <section id="character-details" class="character-details-container">
        <div class="legend-wounds-container">
            <div>
                <div class="character-name-container bg-brown border-thin mb-1">
                    <div>
                        <h5>Character Name:</h5>
                        <input id="characterName" type="text" class="w-100" name="attr_character_name" placeholder="Character Name" type="text">  
                    </div>
                    <div>
                        <h5>Character Lineage and Culture:</h5>
                        <input id="characterLineageCulture" type="text" class="w-100" name="attr_lineage_and_culture" placeholder="Character Lineage and Culture" type="text">
                    </div>
                    <div>
                        <h5>Character Faction and Path:</h5>
                        <input id="characterFactionPath" type="text" class="w-100" name="attr_faction_and_path" placeholder="Character Faction And Path" type="text">
                    </div>
                </div>

                
                <div class="xp-wounds-container bg-lpink border-thin">

                    <div id="legend-section" class="legend-section-container mb-1">
                        <div class="generic-content-column">
                            XP: 
                            <input type="text" class="w-100" name="attr_xp" placeholder="XP" type="text">

                            Path Rank: 
                            <input type="text" class="w-100 legend-section-input" name="attr_path_rank" placeholder="Path Rank">    

                            Size: 
                            <input id="size" type="text" class="w-100 legend-section-input" name="attr_size">  
                        </div>
                        <div class="legend-values-container">

                            Permanent Legend: 
                            <input type="text" class="w-100 legend-section-input" name="attr_legend_permanent" placeholder="Legend" type="text">

                            Temporary Legend: 
                            <input type="text" class="w-100 legend-section-input" name="attr_legend_temp" placeholder="Temporary Legend" type="text">

                            <div></div>
        
                        </div>
                        <div class="generic-content-column">
                            Max HP: <input type="text" class="w-100 legend-section-input" name="attr_max_hp" placeholder="Max HP" type="text">


                            HP Multiplier: <input id="hp_multiplier" type="text" class="w-100 legend-section-input" name="attr_hp_multiplier" placeholder="HP Multiplier" type="text">


                            Current HP: <input type="text" class="w-100 legend-section-input" name="attr_hp_current" placeholder="Current HP" type="text">
        
                        </div>

                    </div>

                    <div id="soak-wounds-section" class="soak-wounds-section-container">

                        <div>
                            <h5 class="text-center m-0">Soak</h5>

                            Kinetic: <input type="text" class="w-100 " name="attr_soak_kinetic" placeholder="Kinetic Soak">
                            Elemental: <input type="text" class="w-100 " name="attr_soak_elemental" placeholder="Elemental Soak">
                            Biological: <input type="text" class="w-100 " name="attr_soak_biological" placeholder="Biological Soak">
                            Arcane: <input type="text" class="w-100 " name="attr_soak_arcane" placeholder="Arcane Soak">
                            Cash: <input type="text" class="w-100" name="attr_cash" placeholder="Â¥" type="text">
                        </div>  

                        <div>
                            <h5 class="text-center m-0">Wounds</h5>

                            Grazed: <input type="text" class="w-100 " name="attr_grazed">
                            Flesh Wound: <input type="text" class="w-100 " name="attr_flesh_wound">
                            Banged Up: <input type="text" class="w-100 " name="attr_banged_up">
                            Hurt Bad: <input type="text" class="w-100 " name="attr_hurt_bad">
                            Burning Legend: <input type="text" class="w-100" name="attr_burning_legend" value="0">
                        </div> 

                    </div>

                    <div id="status-effects-section" class="">
                        <div>
                            Active Status Effects: 
                        </div>
                        <textarea class="conditions-textarea" name="attr_active_status_effects" placeholder="Status Effects" 
                            type="text" style="max-width: 97.5%; min-width: 97.5%;"></textarea>
                    </div>
                    
                </div>
            </div>
        </div>

        <div class="stats-container bg-grey border-thin">
            <div>
                <div class="root-stats-container">
                    <div class="generic-content-column">
                        <div>
                            <h5>Power:</h5>
                            <span class="roll-button-container">
                                <input id="power" type="text" class="w-75" name="attr_power" placeholder="10" value="10">  
                                <button id="roll_power" name="act_roll_power" type="action" class="m-0 roll-button" ><span style="font-family:dicefontd20;">t</span></button>
                            </span>

                                
                            </button>
                        </div>
                        <div>
                            <h5>Reflex:</h5>
                            <span class="roll-button-container">
                                <input id="reflex" type="text" class="w-75" name="attr_reflex" placeholder="10" value="10">
                                <button id="roll_reflex" name="act_roll_reflex" type="action" class="m-0 roll-button"><span style="font-family:dicefontd20;">t</span></button>
                            </span>
                        </div>

                    </div>  
                    <div class="generic-content-column">
                        <div>
                            <h5>Heart:</h5>
                            <span class="roll-button-container">
                                <input id="heart" type="text" class="w-75" name="attr_heart" placeholder="10" value="10">
                                <button id="roll_heart" name="act_roll_heart" type="action" class="m-0 roll-button">  <span style="font-family:dicefontd20;">t</span></button>
                            </span>
                        </div>
                        <div>
                            <h5>Savvy:</h5>
                            <span class="roll-button-container">
                                <input id="savvy" type="text" class="w-75" name="attr_savvy" placeholder="10" value="10">
                                <button id="roll_savvy" name="act_roll_savvy" type="action" class="m-0 roll-button"><span style="font-family:dicefontd20;">t</span></button>
                            </span>
                        </div>

                    </div>   
                    <div class="generic-content-column">
                        <div>
                            <h5>Presence:</h5>
                            <span class="roll-button-container">
                                <input id="presence" type="text" class="w-75" name="attr_presence" placeholder="10" value="10"> 
                                <button id="roll_presence" name="act_roll_presence" type="action" class="m-0 roll-button">   <span style="font-family:dicefontd20;">t</span></button>
                            </span>
                        </div>
                        <div>
                            <h5>Perception:</h5>
                            <span class="roll-button-container">
                                <input id="perception" type="text" class="w-75" name="attr_perception" placeholder="0" >
                                <button id="roll_perception" name="act_roll_perception" type="action" class="m-0 roll-button"><span style="font-family:dicefontd20;">t</span></button>
                            </span>
                        </div>
                        <div>
                            <h5>Shinpi:</h5>
                            <span class="roll-button-container">
                                <input id="shinpi" type="text" class="w-75" name="attr_shinpi" placeholder="0" >
                                <button id="roll_shinpi" name="act_roll_shinpi" type="action" class="m-0 roll-button"><span style="font-family:dicefontd20;">t</span></button>
                            </span>
                        </div>

                    </div>  
                </div>

        <h5 class="w-100" style="text-align: center;">
            Derived Traits 
        </h5>

        <div id="derived-traits" class="derived-traits-container">
                        

            <div class="generic-content-column">

                <span>Resolve (base): </span>
                
                <input type="text" class="w-100 legend-section-input" name="attr_resolve_base">

                <span>Resolve: </span>
                
                <input type="text" class="w-100 legend-section-input" name="attr_resolve">

            </div>
            <div class="generic-content-column">

                <span>Move (base): </span>
                
                <input type="text" class="w-100 legend-section-input" name="attr_move_base">

                <span>Move:</span>
                
                <input type="text" class="w-100 legend-section-input" name="attr_move">

            </div>
            <div class="generic-content-column">

                <span>Initiative (base):</span> 
                
                <input type="text" class="w-100 legend-section-input" name="attr_initiative_base">

                <span>Initiative:</span>

                <div class="initiative-roller">

                    <input type="text" class="w-100" name="attr_initiative"> 

                        <button id="roll_initiative" name="act_roll_initiative" type="action" class="m-0 roll-button">  <span style="font-family:dicefontd20;">t</span></button>

                </div>



            </div>
            <div class="generic-content-column">

                Defence (base): <input type="text" class="w-100 legend-section-input" name="attr_defence_base">

                Defence: <input type="text" class="w-100 legend-section-input" name="attr_defence">

            </div>

        </div>

        <div>
            <div>
                Lineage & Path Bonuses, Augs, Rotes, Skills, Abilities, Etc.
            </div>

            <textarea class="conditions-textarea" style="max-width: 97.5%; min-width: 97.5%;" name="attr_bonuses"></textarea>
        </div>

        <div>
                    <h5 class="w-100" style="text-align: center;">
            Action Economy 
        </h5>
        <div id="fav_action_uses" class="three-column">
            <div class="column-3">
            
                <div class="w-100" style="text-align: center;">
                    Move Action:
                </div>
                <input type="text" class="w-100 legend-section-input" placeholder="# of Attacks" name="attr_move_action_attack_count">
                <br>

                Favorite Actions: 
                <input type="text" class="w-100 mb-2px" name="attr_move_action_favorites1">
                <input type="text" class="w-100 mb-2px" name="attr_move_action_favorites2" >
                <input type="text" class="w-100 mb-2px" name="attr_move_action_favorites3">

            </div>
            <div class="column-3">

                <div class="w-100" style="text-align: center;">
                    Quick Action:
                </div>
                <input type="text" class="w-100 legend-section-input" placeholder="# of Attacks" name="attr_quick_action_attack_count">

                Favorite Actions: 
                <input type="text" class="w-100 mb-2px" name="attr_quick_action_favorites1" >
                <input type="text" class="w-100 mb-2px" name="attr_quick_action_favorites2">
                <input type="text" class="w-100 mb-2px" name="attr_quick_action_favorites3" >


            </div>
            <div class="column-3">

                <div class="w-100" style="text-align: center;">
                    Full Action:
                </div>
                <input type="text" class="w-100 legend-section-input" placeholder="# of Attacks" name="attr_full_action_attack_count">

                Favorite Actions: 
                <input type="text" class="w-100 mb-2px" name="attr_full_action_favorites1">
                <input type="text" class="w-100 mb-2px" name="attr_full_action_favorites2">
                <input type="text" class="w-100 mb-2px" name="attr_full_action_favorites3" >

            </div>
        </div>
        </div>
        </div>

    </section>

    <section id="fate-card">

        <div class="border-thin bg-black fate-card-container">
            <div class="fate-card-header-container">
                <div class="generic-roller">
                    <button id="roll_fate" name="act_roll_fate" type="action" title="Roll Fate" class="m-0 roll-button-grid" ><span style="font-family:dicefontd20;">t</span></button>
                </div>
                <div>
                    <h3 class="no-underline">Fate Card</span>  
                </div>
                <div class="hider-holder">
                    <input type="checkbox" class="fate-hider" name="attr_fate_hidden"> 
                </div>
            </div>

            <input type="checkbox" class="fate-hider" name="attr_fate_hidden" hidden> 
            <div id="fate-card-contents" class="fate-card-contents-container can-hide">

                <div class="fate-card-fate-line-container" style="font-size:12px; height: 20px !important;">
                    <h5 class="w-5">Min</h5>
                    <h5 class="w-5">Max</h5>
                    <h5 class="w-85">Description</h5>
                    <h5 class="w-5"></h5>
                </div>

                <fieldset class="repeating_fate-lines" style="display: none;">

                    <div class="fate-card-fate-line-container" style="font-size:12px;">
                        <div class="w-5">
                            <input type="text" class="" placeholder="min" name="attr_minpercent"> 
                        </div>
                        <div class="w-5">
                            <input type="text" class="" placeholder="max" name="attr_maxpercent"> 
                        </div>

                        <textarea type="text" class="w-90 lockwidth-fate-textarea" style="height: 18px;" placeholder="" name="attr_desc"></textarea>

                    </div>
                </fieldset>
                
            </div>
    
        </div> 

    </section>
    
    <section id="equipment-card">
        <div class="border-thin bg-blue equipment-card-container">
            <div class="equipment-card-header-container">
                <div>
                    
                </div>
                <div>
                    <h3 class="no-underline">Equipment</span>   
                </div>
                <div class="hider-holder">
                    
                </div>

            </div>
            <input type="checkbox" class="equipment-hider" name="attr_equipment_hidden" hidden> 

                <fieldset class="repeating_equipment-lines" style="display: none;">

                    <div class="equipment-card-equipment-line-container bg-ltblue border-thin mb-1" style="font-size:12px;">

                        <div class="equipment-card-equipment-line-container-header">
                            <div class="generic-roller">
                                <button id="roll_wep" name="act_roll-wep" type="action" class="m-0 roll-button-grid" ><span style="font-family:dicefontd20;">t</span></button>
                            </div>
                            <div>
                                <span class="header-4"><input class="w-100" type="text" name="attr_wep_name" style="text-align: center;" readonly></span>  
                            </div>
                            <div class="hider-holder">
                                <input type="checkbox" class="equipment-hider" name="attr_equipment_hidden"> 
                            </div>
                        </div>
                        <input type="checkbox" class="equipment-line-hider" name="attr_equipment_hidden" hidden> 
                        <div class="equipment-card-equipment-line-contents-body can-hide">
                            <div class="equipment-card-equipment-line-details">
                                <div class="pl-2px">
                                    Name
                                </div>
                                <div class="pl-2px">
                                    Skill
                                </div>
                                <div class="pl-2px">
                                    Quality
                                </div>
                                <div class="pl-2px">
                                    Grit
                                </div>
                                <div class="pl-2px">
                                    Tier
                                </div>
                                <div>
                                    <input class="w-100" type="text" name="attr_wep_name">
                                </div>
                                <div>                                
                                    <select name="attr_wep_skill_name" id="wep_skill_name" class="w-100" style="margin-bottom: 0px;">
                                        <option value="archery">Archery</option>
                                        <option value="arcana">Arcana</option>
                                        <option value="athletics">Athletics</option>
                                        <option value="banter">Banter</option>
                                        <option value="commerce">Commerce</option>
                                        <option value="computers">Computers</option>
                                        <option value="crafting">Crafting</option>
                                        <option value="deception">Deception</option>
                                        <option value="drive">Drive</option>
                                        <option value="dodge">Dodge</option>
                                        <option value="eloquence">Eloquence</option>
                                        <option value="gambling">Gambling</option>
                                        <option value="gunnery">Gunnery</option>
                                        <option value="hardware">Hardware</option>
                                        <option value="heavy_melee">Heavy Melee</option>
                                        <option value="intimidation">Intimidation</option>
                                        <option value="intuition">Intuition</option>
                                        <option value="investigation">Investigation</option>
                                        <option value="light_melee">Light Melee</option>
                                        <option value="medicine">Medicine</option>
                                        <option value="meditation">Meditation</option>
                                        <option value="performance">Performance</option>
                                        <option value="rally">Rally</option>
                                        <option value="security">Security</option>
                                        <option value="seduction">Seduction</option>
                                        <option value="sleight_of_hand">Sleight of Hand</option>
                                        <option value="small_arms">Small Arms</option>
                                        <option value="stealth">Stealth</option>
                                        <option value="streetwise">Streetwise</option>
                                        <option value="study">Study</option>
                                        <option value="surveillance">Surveillance</option>
                                        <option value="survival">Survival</option>
                                        <option value="tactics">Tactics</option>
                                        <option value="toxicology">Toxicology</option>
                                        <option value="thrown">Thrown</option>
                                        <option value="unarmed">Unarmed</option>
                                        <option value="wetware">Wetware</option>
                                        <option value="" selected="selected">-</option>
                                    </select>
                                </div>
                                <div>
                                    <input class="w-100" type="text" name="attr_wep_quality">
                                </div>
                                <div>
                                    <input class="w-100" type="text" name="attr_wep_grit">
                                </div>
                                <div>
                                    <input class="w-100" type="text" name="attr_wep_tier">
                                </div>

                            </div>
                            <div class="equipment-card-equipment-line-stats">
                                <div class="pl-2px">
                                    Short/Melee
                                </div>
                                <div>
                                    Long/Thrown
                                </div>
                                <div class="pl-2px">
                                    Damage
                                </div>
                                <div class="pl-2px">
                                    Attack Bonus
                                </div>
                                <div class="pl-2px">
                                    Ammo Carried
                                </div>
                                <div class="pl-2px">
                                    Mag Size
                                </div>
                                <div>
                                    <input class="w-100" type="text" name="attr_wep_short_range">
                                </div>
                                <div>
                                    <input class="w-100" type="text" name="attr_wep_long_range">
                                </div>
                                <div>
                                    <input class="w-100" type="text" name="attr_wep_damage" placeholder="Damage">
                                </div>
                                <div>
                                    <input class="w-100" type="text" name="attr_wep_attack_bonus">
                                </div>
                                <div>
                                    <input class="w-100" type="text" name="attr_wep_ammo">
                                </div>
                                <div>
                                    <input class="w-100" type="text" name="attr_wep_mag_size">
                                </div>
                            </div>
                            <div class="equipment-card-equipment-line-stats">
                                <div class="pl-2px">
                                    Short Mod
                                </div>
                                <div class="pl-2px">
                                    Long Mod
                                </div>
                                <div class="pl-2px">
                                    Damage Type
                                </div>
                                <div class="pl-2px">
                                    Damage Bonus
                                </div>
                                <div class="pl-2px">
                                    Burst Ammo
                                </div>
                                <div>

                                </div>
                                <div>
                                    <input class="w-100" type="text" name="attr_wep_short_modifier" placeholder="X">
                                </div>
                                <div>
                                    <input class="w-100" type="text" name="attr_wep_long_modifier" placeholder="X">
                                </div>
                                <div>
                                    <input class="w-100" type="text" name="attr_wep_damage_type" placeholder="Type">
                                </div>
                                <div>
                                    <input class="w-100" type="text" name="attr_wep_damage_bonus">
                                </div>
                                <div>
                                    <input class="w-100" type="text" name="attr_wep_burst_ammo">
                                </div>
                                <div>
                                </div>
                            </div>
                            <div>
                                <div class="pl-2px">
                                    Weapon Skill Unlocks, features, upgrades and notes
                                </div>
                                <textarea type="text" class="w-98 lockwidth-equipment-textarea" style="height: 18px;" placeholder="" name="attr_wep_details"></textarea>
                            </div>
                            <div style="text-align: center;">
                                Filled Mod Slots 
                                <input type="checkbox" name="attr_wep_mod_slot1">
                                <input type="checkbox" name="attr_wep_mod_slot2">
                                <input type="checkbox" name="attr_wep_mod_slot3">
                                <input type="checkbox" name="attr_wep_mod_slot4">
                                <input type="checkbox" name="attr_wep_mod_slot5">
                            </div>
                        </div>

                    </div>
                </fieldset>

            </div>
        </div>
    </section>

    <section id="augs-section">
        <div class="border-thin bg-cyan augments-card-container">
            <div class="augments-card-header-container">
                <div>
                    
                </div>
                <div>
                    <h3 class="no-underline">Augs</span>   
                </div>
                <div class="hider-holder">
                    
                </div>

            </div>
            <fieldset class="repeating_augment-lines" style="display: none;">

                    <div class="augments-card-augments-line-container bg-ltcyan border-thin mb-1" style="font-size:12px;">

                        <div class="augments-card-augments-line-container-header">
                            <div class="generic-roller">
                                
                            </div>
                            <div>
                                <span class="header-4"><input class="w-100" type="text" name="attr_aug_name" style="text-align: center;" readonly></span>  
                            </div>
                            <div class="hider-holder">
                                <input type="checkbox" class="augments-hider" name="attr_augment_hidden"> 
                            </div>
                        </div>
                        <input type="checkbox" class="augments-line-hider" name="attr_augment_hidden" hidden> 
                        <div class="augments-card-augments-line-contents-body can-hide">
                            <div class="pl-2px">
                                Name
                            </div>
                            <div class="pl-2px">
                                Rank
                            </div>
                            <div class="pl-2px">
                                Details
                            </div>
                            <div>
                                <input class="w-100" type="text" name="attr_aug_name" placeholder="">
                            </div>
                            <div>
                                <input class="w-100" type="text" name="attr_aug_rank" placeholder="">
                            </div>
                            <div>
                                <textarea type="text" class="w-98 lockwidth-augments-textarea" style="height: 18px;" placeholder="" name="attr_aug_details"></textarea>
                            </div>

                        </div>

                    </div>
                </fieldset>
        </div>
    </section>

    <section id="skills-section">
        <div class="border-thin bg-green skills-card-container">
            <div class="skills-card-header-container">
                <div>

                </div>
                <div>
                    <h3 class="no-underline">Skills</span>   
                </div>
                <div class="hider-holder">
                    
                </div>

            </div>

            <fieldset class="repeating_skills-lines" style="display: none;">
                                <div class="skills-card-skills-line-container bg-ltgreen border-thin mb-1" style="font-size:12px;">
                    <div class="skills-card-skills-line-container-header">
                        <div class="generic-roller">
                            <button id="roll_skill" name="act_roll-skill" type="action" class="m-0 roll-button-grid" ><span style="font-family:dicefontd20;">t</span></button>
                        </div>
                        <div>
                            <span class="header-4"><input class="w-100" type="text" name="attr_skill_name" style="text-align: center;" readonly></span>  
                        </div>
                        <div class="hider-holder">
                            <input type="checkbox" class="skills-hider" name="attr_skill_hidden"> 
                        </div>
                    </div>
                    <input type="checkbox" class="skills-line-hider" name="attr_skill_hidden" hidden> 
                    <div class="skills-card-skills-line-contents-body can-hide">
                        <div class="skills-card-skills-line-contents-stats">
                            <select name="attr_skill_name" id="skill_name" class="w-100" style="margin-bottom: 0px;">
                                <option value="Archery">Archery</option>
                                <option value="Arcana">Arcana</option>
                                <option value="Athletics">Athletics</option>
                                <option value="Banter">Banter</option>
                                <option value="Commerce">Commerce</option>
                                <option value="Computers">Computers</option>
                                <option value="Crafting">Crafting</option>
                                <option value="Deception">Deception</option>
                                <option value="Drive">Drive</option>
                                <option value="Dodge">Dodge</option>
                                <option value="Eloquence">Eloquence</option>
                                <option value="Gambling">Gambling</option>
                                <option value="Gunnery">Gunnery</option>
                                <option value="Hardware">Hardware</option>
                                <option value="Heavy_melee">Heavy Melee</option>
                                <option value="Intimidation">Intimidation</option>
                                <option value="Intuition">Intuition</option>
                                <option value="Investigation">Investigation</option>
                                <option value="Light_melee">Light Melee</option>
                                <option value="Medicine">Medicine</option>
                                <option value="Meditation">Meditation</option>
                                <option value="Performance">Performance</option>
                                <option value="Rally">Rally</option>
                                <option value="Security">Security</option>
                                <option value="Seduction">Seduction</option>
                                <option value="Sleight of Hand">Sleight of Hand</option>
                                <option value="Small_arms">Small Arms</option>
                                <option value="Stealth">Stealth</option>
                                <option value="Streetwise">Streetwise</option>
                                <option value="Study">Study</option>
                                <option value="Surveillance">Surveillance</option>
                                <option value="Survival">Survival</option>
                                <option value="Tactics">Tactics</option>
                                <option value="Toxicology">Toxicology</option>
                                <option value="Thrown">Thrown</option>
                                <option value="Unarmed">Unarmed</option>
                                <option value="Wetware">Wetware</option>
                                <option value="" selected="selected">-</option>
                            </select>
                            <select class="m-0 no-select-arrow text-center" name="attr_skill_focus1">
                                <option value="" selected="selected">-</option>
                                <option value="d4">d4</option>
                                <option value="d6">d6</option>
                                <option value="d8">d8</option>
                                <option value="d12">d12</option>
                            </select>
                            <select class="m-0 no-select-arrow text-center" name="attr_skill_focus2">
                                <option value="" selected="selected">-</option>
                                <option value="d4">d4</option>
                                <option value="d6">d6</option>
                                <option value="d8">d8</option>
                                <option value="d12">d12</option>
                            </select>
                            <select class="m-0 no-select-arrow text-center" name="attr_skill_focus3">
                                <option value="" selected="selected">-</option>
                                <option value="d4">d4</option>
                                <option value="d6">d6</option>
                                <option value="d8">d8</option>
                                <option value="d12">d12</option>
                            </select>
                            <select class="m-0 m-0 no-select-arrow text-center" name="attr_skill_focus4">
                                <option value="" selected="selected">-</option>
                                <option value="d4">d4</option>
                                <option value="d6">d6</option>
                                <option value="d8">d8</option>
                                <option value="d12">d12</option>
                            </select>
                            <select class="m-0 no-select-arrow text-center" name="attr_skill_focus5">
                                <option value="" selected="selected">-</option>
                                <option value="d4">d4</option>
                                <option value="d6">d6</option>
                                <option value="d8">d8</option>
                                <option value="d12">d12</option>
                            </select>
                            <input type="text" class="text-center" placeholder="+" name="attr_skill_mod">
                            <select name="attr_skill_trait" id="skill_trait" class="w-100" style="margin-bottom: 0px;" >
                                <option value="" selected>-</option>  
                                <option value="power">Power</option>
                                <option value="reflex">Reflex</option>
                                <option value="heart">Heart</option>
                                <option value="savvy">Savvy</option>
                                <option value="perception">Perception</option>
                                <option value="presence">Presence</option>
                                <option value="shinpi">Shinpi</option>                               
                            </select> 
                        </div>
                        <div class="skills-card-skills-line-contents-details">
                            <div class="pl-2px">
                                Skill Ability Notes
                            </div>
                            <textarea type="text" class="w-98 lockwidth-skill-textarea" style="height: 18px;" placeholder="" name="attr_skill_details"></textarea>
                        </div>
                    </div>

                </div>
            </fieldset>

            <div class="skills-card-header-container">
                <div>

                </div>
                <div>
                    <h4 class="no-underline">Custom Skills</span>   
                </div>
                <div class="hider-holder">
                    
                </div>

            </div>

            <fieldset class="repeating_custskills-lines" style="display: none;">

                    <div class="skills-card-skills-line-container bg-ltgreen border-thin mb-1" style="font-size:12px;">

                        <div class="skills-card-skills-line-container-header">
                            <div class="generic-roller">
                                <button id="roll_custskill" name="act_roll-custskill" type="action" class="m-0 roll-button-grid" ><span style="font-family:dicefontd20;">t</span></button>
                            </div>
                            <div>
                                <span class="header-4"><input class="w-100" type="text" name="attr_skill_name" style="text-align: center;" readonly></span>  
                            </div>
                            <div class="hider-holder">
                                <input type="checkbox" class="skills-hider" name="attr_skill_hidden"> 
                            </div>
                        </div>
                        <input type="checkbox" class="skills-line-hider" name="attr_skill_hidden" hidden> 
                        <div class="skills-card-skills-line-contents-body can-hide">
                            <div class="skills-card-skills-line-contents-stats">
                                <input type="text" class="w-100" name="attr_skill_name" placeholder="Custom">
                                <select class="m-0 no-select-arrow text-center" name="attr_skill_focus1">
                                    <option value="" selected="selected">-</option>
                                    <option value="d4">d4</option>
                                    <option value="d6">d6</option>
                                    <option value="d8">d8</option>
                                    <option value="d12">d12</option>
                                </select>
                                <select class="m-0 no-select-arrow text-center" name="attr_skill_focus2">
                                    <option value="" selected="selected">-</option>
                                    <option value="d4">d4</option>
                                    <option value="d6">d6</option>
                                    <option value="d8">d8</option>
                                    <option value="d12">d12</option>
                                </select>
                                <select class="m-0 no-select-arrow text-center" name="attr_skill_focus3">
                                    <option value="" selected="selected">-</option>
                                    <option value="d4">d4</option>
                                    <option value="d6">d6</option>
                                    <option value="d8">d8</option>
                                    <option value="d12">d12</option>
                                </select>
                                <select class="m-0 m-0 no-select-arrow text-center" name="attr_skill_focus4">
                                    <option value="" selected="selected">-</option>
                                    <option value="d4">d4</option>
                                    <option value="d6">d6</option>
                                    <option value="d8">d8</option>
                                    <option value="d12">d12</option>
                                </select>
                                <select class="m-0 no-select-arrow text-center" name="attr_skill_focus5">
                                    <option value="" selected="selected">-</option>
                                    <option value="d4">d4</option>
                                    <option value="d6">d6</option>
                                    <option value="d8">d8</option>
                                    <option value="d12">d12</option>
                                </select>
                                <input type="text" class="text-center" placeholder="+" name="attr_skill_mod">
                                <select name="attr_skill_trait" id="skill_trait" class="w-100" style="margin-bottom: 0px;" >
                                    <option value="" selected>-</option>  
                                    <option value="power">Power</option>
                                    <option value="reflex">Reflex</option>
                                    <option value="heart">Heart</option>
                                    <option value="savvy">Savvy</option>
                                    <option value="perception">Perception</option>
                                    <option value="presence">Presence</option>
                                    <option value="shinpi">Shinpi</option>                               
                                </select> 
                            </div>
                            <div class="skills-card-skills-line-contents-details">
                                <div class="pl-2px">
                                    Skill Ability Notes
                                </div>
                                <textarea type="text" class="w-98 lockwidth-skill-textarea" style="height: 18px;" placeholder="" name="attr_skill_details"></textarea>
                            </div>
                        </div>

                    </div>
            </fieldset>
        </div>
    </section>

    <section id="rotes-section">
                <div class="border-thin bg-purple rotes-card-container">
            <div class="rotes-card-header-container">
                <div>
                    
                </div>
                <div>
                    <h3 class="no-underline">Rotes</span>   
                </div>
                <div class="hider-holder">
                    
                </div>

            </div>
            <div class="rotes-card-kami-details-container">
                <div class="pl-2px">
                    Mikata Kami and bonus:
                </div>
                <div class="pl-2px">
                    Accessed Kami:
                </div>
                <div>
                    <input class="w-100" type="text" name="attr_mikata_and_bonus">   
                </div>
                <div>
                    <input class="w-100" type="text" name="attr_accessed_kami">  
                </div>
            </div>
            <fieldset class="repeating_rotes-lines" style="display: none;">

                    <div class="rotes-card-rote-line-container bg-ltpurple border-thin mb-1" style="font-size:12px;">

                        <div class="rotes-card-rotes-line-container-header">
                            <div class="generic-roller">
                                <button id="roll_rote" name="act_roll-rote" type="action" class="m-0 roll-button"><span style="font-family:dicefontd20;">t</span></button>
                            </div>
                            <div>
                                <span class="header-4"><input class="w-100" type="text" name="attr_rote_name" style="text-align: center;" readonly></span>  
                            </div>
                            <div class="hider-holder">
                                <input type="checkbox" class="rotes-hider" name="attr_rote_hidden"> 
                            </div>
                        </div>
                        
                        <input type="checkbox" class="rotes-line-hider" name="attr_rote_hidden" hidden> 

                        <div class="rotes-card-rotes-line-contents-body can-hide">
                            <div class="rotes-card-rotes-line-contents-stats">
                                <div>Name</div>
                                <div>Action</div>
                                <div>TN</div>
                                <div>LC</div>
                                <div>Range</div>
                                <div>Duration</div>
                                <div>Casting Skill</div>

                                <input type="text" class="w-100" name="attr_rote_name">
                                <input type="text" class="w-100" name="attr_rote_action">
                                <input type="text" class="w-100" name="attr_rote_tn">
                                <input type="text" class="w-100" name="attr_rote_legend_cost">
                                <input type="text" class="w-100" name="attr_rote_range">
                                <input type="text" class="w-100" name="attr_rote_duration">
                                <select name="attr_rote_casting_skill" id="rote_casting_skill" class="w-100" style="margin-bottom: 0px;">
                                    <option value="archery">Archery</option>
                                    <option value="arcana">Arcana</option>
                                    <option value="athletics">Athletics</option>
                                    <option value="banter">Banter</option>
                                    <option value="commerce">Commerce</option>
                                    <option value="computers">Computers</option>
                                    <option value="crafting">Crafting</option>
                                    <option value="deception">Deception</option>
                                    <option value="drive">Drive</option>
                                    <option value="dodge">Dodge</option>
                                    <option value="eloquence">Eloquence</option>
                                    <option value="gambling">Gambling</option>
                                    <option value="gunnery">Gunnery</option>
                                    <option value="hardware">Hardware</option>
                                    <option value="heavy_melee">Heavy Melee</option>
                                    <option value="intimidation">Intimidation</option>
                                    <option value="intuition">Intuition</option>
                                    <option value="investigation">Investigation</option>
                                    <option value="light_melee">Light Melee</option>
                                    <option value="medicine">Medicine</option>
                                    <option value="meditation">Meditation</option>
                                    <option value="performance">Performance</option>
                                    <option value="rally">Rally</option>
                                    <option value="security">Security</option>
                                    <option value="seduction">Seduction</option>
                                    <option value="sleight_of_hand">Sleight of Hand</option>
                                    <option value="small_arms">Small Arms</option>
                                    <option value="stealth">Stealth</option>
                                    <option value="streetwise">Streetwise</option>
                                    <option value="study">Study</option>
                                    <option value="surveillance">Surveillance</option>
                                    <option value="survival">Survival</option>
                                    <option value="tactics">Tactics</option>
                                    <option value="toxicology">Toxicology</option>
                                    <option value="thrown">Thrown</option>
                                    <option value="unarmed">Unarmed</option>
                                    <option value="wetware">Wetware</option>
                                    <option value="" selected="selected">-</option>
                                </select>
                            </div>
                            <div class="rotes-card-rotes-line-contents-details">
                                <textarea type="text" class="w-98 lockwidth-skill-textarea" style="height: 18px;" placeholder="" name="attr_rote_details"></textarea>
                            </div>

                        </div>

                    </div>
                </fieldset>
        </div>
    </section>

    <section id="backgrounds-card">
        <div class="border-thin bg-orange backgrounds-card-container">
            <div class="backgrounds-card-header-container">
                <div>
                    <button id="roll_null" name="act_roll_null" type="action" class="m-0 roll-button-grid" style="opacity: 0;" disabled><span style="font-family:dicefontd20;">t</span></button>
                </div>
                <div>
                    <h3 class="no-underline">BackGrounds</span>   
                </div>
                <div class="hider-holder">
                    <input type="checkbox" class="background-hider" name="attr_backgrounds_hidden"> 
                </div>

            </div>

            <input type="checkbox" class="background-hider" name="attr_backgrounds_hidden" hidden> 

            <div id="background-card-contents" class="backgrounds-card-contents-container can-hide">
                <div id="backgrounds-content-header" class="backgrounds-card-content-header">
                    <div>
                        
                    </div>
                    <div style="margin-left: 5px;">
                        Score
                    </div>
                    <div style="margin-left: 5px;">
                        Description
                    </div>
                    <div>
                        
                    </div>
                </div>

                <div class="backgrounds-card-background-line-container">
                    <div class="backgrounds-card-contents-body">
                        <div class="backgrounds-card-background-line-container-header"><strong>Contacts:</strong></div>
                        <div><input class="w-100" type="text" name="attr_contacts_score"></div>
                        <div><textarea class="lockwidth-background-textarea" style="height: 18px;" type="text" name="attr_contacts_description"></textarea></div>
                        <div class="backgrounds-card-background-line-container-button-holder">
                            <div>
                                <button id="roll_contacts" name="act_roll_contacts" type="action" class="m-0 roll-button"><span style="font-family:dicefontd20;">t</span></button>

                            </div>
                        </div>
                    </div> 
                </div>

                <div class="backgrounds-card-background-line-container">
                    <div class="backgrounds-card-contents-body">
                        <div class="backgrounds-card-background-line-container-header"><strong>Followers:</strong></div>
                        <div><input class="w-100" type="text" name="attr_followers_score"></div>
                        <div><textarea class="lockwidth-background-textarea" style="height: 18px;" type="text" name="attr_followers_description"></textarea></div>
                        <div class="backgrounds-card-background-line-container-button-holder">
                            <div>
                                <button id="roll_followers" name="act_roll_followers" type="action" class="m-0 roll-button"><span style="font-family:dicefontd20;">t</span></button>
                            </div>
                        </div>
                    </div> 
                </div>

                <div class="backgrounds-card-background-line-container">
                    <div class="backgrounds-card-contents-body">
                        <div class="backgrounds-card-background-line-container-header"><strong>Soul:</strong></div>
                        <div><input class="w-100" type="text" name="attr_soul_score"></div>
                        <div><textarea class="lockwidth-background-textarea" style="height: 18px;" type="text" name="attr_soul_description"></textarea></div>
                        <div class="backgrounds-card-background-line-container-button-holder">
                            <div>
                                <button id="roll_soul" name="act_roll_soul" type="action" class="m-0 roll-button"><span style="font-family:dicefontd20;">t</span></button>

                            </div>
                        </div>
                    </div> 
                </div>

                <div class="backgrounds-card-background-line-container">
                    <div class="backgrounds-card-contents-body">
                        <div class="backgrounds-card-background-line-container-header"><strong>Status:</strong></div>
                        <div><input class="w-100" type="text" name="attr_status_score"></div>
                        <div><textarea class="lockwidth-background-textarea" style="height: 18px;" type="text" name="attr_status_description"></textarea></div>
                        <div class="backgrounds-card-background-line-container-button-holder">
                            <div>
                                <button id="roll_status" name="act_roll_status" type="action" class="m-0 roll-button"><span style="font-family:dicefontd20;">t</span></button>
                            </div>
                        </div>
                    </div> 
                </div>

                <div class="backgrounds-card-background-line-container">
                    <div class="backgrounds-card-contents-body">
                        <div class="backgrounds-card-background-line-container-header"><strong>Wealth:</strong></div>
                        <div><input class="w-100" type="text" name="attr_wealth_score"></div>
                        <div><textarea class="lockwidth-background-textarea" style="height: 18px;" type="text" name="attr_wealth_description"></textarea></div>
                        <div class="backgrounds-card-background-line-container-button-holder">
                            <div>
                                <button id="roll_wealth" name="act_roll_wealth" type="action" class="m-0 roll-button"><span style="font-family:dicefontd20;">t</span></button>

                            </div>
                        </div>
                    </div> 
                </div>

                <div class="backgrounds-card-background-line-container mb-1">
                    <div class="backgrounds-card-contents-body">
                        <div class="backgrounds-card-background-line-container-header"><strong>Cash:</strong></div>
                        <div><input type="text" class="w-100" name="attr_cash" placeholder="Â¥" type="text"></div>
                        <div></div>
                        <div class="backgrounds-card-background-line-container-button-holder">
                        </div>
                    </div> 
                </div>
            </div>

        </div>
    </section>

    <div>
        <p id="damage-footnote" style="letter-spacing:normal;">
            1. If you have burst damage, you must add notation to the damage roll you input. i.e. !2d10>8 means roll 2d10, explode on 8 or more.
        </p>
        <small style="text-align:left;">
            Feedback and contributions can be made <a style="text-decoration: underline;" href="https://github.com/tbolgercode/NewEdoRoll20Sheet">here.</a>
        </small>
    </div>
</main>

<rolltemplate class="sheet-rolltemplate-init">
    <div class="container">
        <h3 style="margin-bottom: 0.3rem; color: white;">{{characterName}} adds Initiative:</h3>
        <div class="">
            <h4>{{initiative}}</h4>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-trait">
    <div class="container">
        <h3 style="margin-bottom: 0.3rem; color: white;">{{characterName}} rolls {{traitName}}:</h3>
        <div class="">
            <h4>{{roll}}</h4>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-wep">
    <div class="container">
        <h3 style="margin-bottom: 0.3rem; color: white;">{{characterName}} rolls attack with {{wepName}}:</h3>
        <div class="sheet-rolltemplate-rote-details" style="text-align: center;">
            <h4 style="margin-bottom: 0.3rem;">Attack Roll:</h4>
            <h4 style="margin-bottom: 0.3rem;">{{attackRoll}}</h4>
            <table class="w-100" style="text-align: center; width:100%;">    
                <tr style="font-size:12px;">
                    <td class="w-10" colspan="2"><h4>Damage</h4></td>
                </tr>
    
                <tr>
                    <td  colspan="2" style="padding: 5px;"><h4>{{damageRoll}}</h4></td>
                </tr>        
                <tr>
                    <td><h4>Short({{shortRange}})</h4></td>
                    <td><h4>Long({{longRange}})</h4></td>
                </tr>        
                <tr>
                    <td style="padding: 5px;"><h4>{{computed::shortDamage}}</h4></td>
                    <td style="padding: 5px;"><h4>{{computed::longDamage}}</h4></td>
                </tr>    
            </table>
            <h5>{{damageType}}</h5>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-rote">                
    <div class="container">
        <h3 style="margin-bottom: 0.3rem; color: white;">{{characterName}} rolls {{roteName}}:</h3>
        <div style="margin-bottom: 0.3rem;" class="">
            <h4>{{roll}}</h4>
        </div>
        <div class="">
            <h4 style="color: rgb(230, 230, 230)">TN: {{tn}}</h4>
        </div>
        <div class="sheet-rolltemplate-rote-details">
            <h4 style="color: white;">Effect:</h4>
            <p>
                {{roteDetails}}
            </p>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-skill">
    <div class="container">
        <h3 style="margin-bottom: 0.3rem; color: white;">{{characterName}} rolls {{skillName}}:</h3>
        <div class="">
            <h4>{{roll}}</h4>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-fate">
    <div class="container">
        <h3 style="margin-bottom: 0.3rem; color: white;">{{characterName}} rolls Fate:</h3>
        <div class="">
            <div style="margin-bottom: 0.3rem;">
                <h4>{{roll}}</h4>
            </div>
            <div class="sheet-rolltemplate-rote-details">
                <h4 style="color: white;">Effect:</h4>
                <p style="color: #e4e4e4;">
                    {{effect}}
                </p>
            </div>

        </div>
    </div>
</rolltemplate>

<script type="text/worker">

    //TODO: Make the attribute manipulation easier?

    ///BUTTON CLICKS

    on("clicked:roll_initiative", (info) => {
        console.log("Adding initiative.");

        getAttrs(["character_name", "initiative", "initiative_base"], (values) => {

            var initiative = values.initiative_base;
            if(parseInt(values.initiative)) initiative = values.initiative;

            startRoll(`&{template:init} {{characterName=${values.character_name}}} {{initiative=[[${initiative} &{tracker}]]}}`, (results) => {
                finishRoll(results.rollId, {});
            });
        });

    });


    on("clicked:repeating_equipment-lines:roll-wep", async (info) => {
        
        console.log(info);
        console.log("rolling weapon attack....");

        const skillIds = [];
        getSectionIDs("skills-lines", function(skillIdArray) {

            console.log(skillIdArray);
            skillids = skillIdArray;

            const wepAttrNames = buildAttackAttrDependencyNames(skillIdArray);

            console.log(wepAttrNames);

            getAttrs(wepAttrNames, (values) => {


                const valueMap = new Map(Object.entries(values));
                console.log(valueMap);

                //get skill name
                const skillName = valueMap.get(`repeating_equipment-lines_wep_skill_name`);
                const wepName = valueMap.get(`repeating_equipment-lines_wep_name`) ? valueMap.get(`repeating_equipment-lines_wep_name`) : "Weapon";

                console.log(values.character_name);

                if(!skillName) return;

                console.log(skillName);

                //SKILL CALC
                const skillId = findSkillInValues(valueMap, skillName, skillids);

                const traitName = skillId === null || skillId === 0 ? getSkillDefault(skillName) : valueMap.get(`repeating_skills-lines_${skillId}_skill_trait`);

                //get traitname
                
                //usee traitName to get value of corresponding trait
                const traitValue = valueMap.get(traitName);

                //parse the trait
                const traitValNum = parseInt(traitValue);

                //calculate d10s
                const traitRoll = getTraitRollD10s(traitValNum);

                const shortRange = valueMap.get(`repeating_equipment-lines_wep_short_range`) ? valueMap.get(`repeating_equipment-lines_wep_short_range`) : "-";

                const longRange = valueMap.get(`repeating_equipment-lines_wep_long_range`) ? valueMap.get(`repeating_equipment-lines_wep_long_range`) : "-";

                const damageType = valueMap.get(`repeating_equipment-lines_wep_damage_type`);

                //roll damage
                let damageRoll = valueMap.get(`repeating_equipment-lines_wep_damage`)

                if(valueMap.get(`repeating_equipment-lines_wep_damage_bonus`)){
                    damageRoll = damageRoll + ` + ${valueMap.get(`repeating_equipment-lines_wep_damage_bonus`)}`
                }

                const longDamage = ""

                const shortDamage = ""
                

                let roll = `${traitRoll}d10!`;

                console.log(roll);

                //add focus
                
                //If there is no skill id (found skill in skills table), no focus/bonuses to add... Roll and exit.
                //long/short range damage is calculated after roll completes, then displayed in finishRoll
                if(parseInt(skillId) === 0){
                    console.log("Skill Id is 0");
                    roll = applyWounds(roll, values);

                    startRoll(`&{template:wep} {{characterName=${values.character_name}}} {{attackRoll=[[${roll}]]}} {{wepName=${wepName}}} {{damageRoll=[[${damageRoll}]]}} {{shortRange=${shortRange}}} {{damageType=${damageType}}} {{longRange=${longRange}}} {{shortDamage=[[0]]}} {{longDamage=[[0]]}}`, (results) => {
                        const shortMod = parseFloat(valueMap.get(`repeating_equipment-lines_wep_short_modifier`)) ? parseFloat(valueMap.get(`repeating_equipment-lines_wep_short_modifier`)) : 1;
                        const longMod = parseFloat(valueMap.get(`repeating_equipment-lines_wep_long_modifier`)) ? parseFloat(valueMap.get(`repeating_equipment-lines_wep_long_modifier`)) : 1;
                        const calcShortDamage = Math.ceil(results.results.damageRoll.result * shortMod);
                        const calcLongDamage = Math.ceil(results.results.damageRoll.result * longMod);
                        console.log("calcShortDamage:");
                        console.log(calcShortDamage);
                        finishRoll(
                            results.rollId,
                            {
                                shortDamage: calcShortDamage,
                                longDamage: calcLongDamage
                            }
                        );
                    });
                    return;
                }


                for(let i = 1; i <= 5; i++){
                    const diceToAdd = valueMap.get(`repeating_skills-lines_${skillId}_skill_focus${i}`);
                    console.log("dice to add:" + diceToAdd);
                    if(diceToAdd) {
                        roll = roll + ' + ' + diceToAdd;
                        console.log(roll);
                    }
                }

                //add mod
                const diceToAdd = valueMap.get(`repeating_skills-lines_${skillId}_skill_mod`);
                if(diceToAdd) {
                    roll = roll + ' + ' + diceToAdd;
                }

                //apply attack bonus
                if(valueMap.get(`repeating_equipment-lines_wep_attack_bonus`)){
                    roll = roll + `+ ${valueMap.get(`repeating_equipment-lines_wep_attack_bonus`)}`;
                }


                roll = applyWounds(roll, values);

                console.log(roll);


                //check results and declare hit/miss
                //long/short range damage is calculated after roll completes, then displayed in finishRoll
                startRoll(`&{template:wep} {{characterName=${values.character_name}}} {{attackRoll=[[${roll}]]}} {{wepName=${wepName}}} {{damageRoll=[[${damageRoll}]]}} {{shortRange=${shortRange}}} {{damageType=${damageType}}} {{longRange=${longRange}}} {{shortDamage=[[0]]}} {{longDamage=[[0]]}}`, (results) => {

                    const shortMod = parseFloat(valueMap.get(`repeating_equipment-lines_wep_short_modifier`));
                    const longMod = parseFloat(valueMap.get(`repeating_equipment-lines_wep_long_modifier`));
                    const calcShortDamage = Math.ceil(results.results.damageRoll.result * shortMod) ? Math.ceil(results.results.damageRoll.result * shortMod) : "N/A";
                    const calcLongDamage = Math.ceil(results.results.damageRoll.result * longMod) ? Math.ceil(results.results.damageRoll.result * longMod) : "N/A";
                    console.log("calcShortDamage:");
                    console.log(calcShortDamage);
                    finishRoll(
                        results.rollId,
                        {
                            shortDamage: calcShortDamage,
                            longDamage: calcLongDamage
                        }
                    );
                });

                console.log("weapon attack roll(s) done.");

            });

        });

    });

    //TODO: Change background rolls to use the map method
    on("clicked:roll_contacts", (info) => {
        console.log("rolling contacts....");

        getAttrs(["contacts_score", "character_name", "max_hp", "hp_current", "grazed", "flesh_wound", "banged_up", "hurt_bad", "burning_legend"], (values) => {

            const roll = getBackgroundD10s(parseInt(values.contacts_score), values);
            
            startRoll(`&{template:trait} {{characterName=${values.character_name}}} {{roll=[[${roll}d10!]]}} {{traitName=Contacts}}`, (results) => {
                const total = results.results.roll.result
    
                finishRoll(
                    results.rollId,
                    {
                        roll: total
                    }
                );
            });

            console.log("contacts roll done.");
        });


    });
    
    on("clicked:roll_followers", (info) => {
        console.log("rolling followers....");

        getAttrs(["followers_score", "character_name", "max_hp", "hp_current", "grazed", "flesh_wound", "banged_up", "hurt_bad", "burning_legend"], (values) => {

            const roll = getBackgroundD10s(parseInt(values.followers_score));

            startRoll(`&{template:trait} {{characterName=${values.character_name}}} {{roll=[[${roll}d10!]]}} {{traitName=Followers}}`, (results) => {
                const total = results.results.roll.result
    
                finishRoll(
                    results.rollId,
                    {
                        roll: total
                    }
                );
            });

            console.log("followers roll done.");
        });


    });    

    on("clicked:roll_soul", (info) => {
        console.log("rolling soul....");

        getAttrs(["soul_score", "character_name", "max_hp", "hp_current", "grazed", "flesh_wound", "banged_up", "hurt_bad", "burning_legend"], (values) => {

            const roll = getBackgroundD10s(parseInt(values.soul_score));

            startRoll(`&{template:trait} {{characterName=${values.character_name}}} {{roll=[[${roll}d10!]]}} {{traitName=Soul}}`, (results) => {
                const total = results.results.roll.result
    
                finishRoll(
                    results.rollId,
                    {
                        roll: total
                    }
                );
            });

            console.log("soul roll done.");
        });


    });   

    on("clicked:roll_status", (info) => {
        console.log("rolling status....");

        getAttrs(["status_score", "character_name", "max_hp", "hp_current", "grazed", "flesh_wound", "banged_up", "hurt_bad", "burning_legend"], (values) => {

            const roll = getBackgroundD10s(parseInt(values.status_score));
            console.log(values);
            startRoll(`&{template:trait} {{characterName=${values.character_name}}} {{roll=[[${roll}d10!]]}} {{traitName=Status}}`, (results) => {
                const total = results.results.roll.result
    
                finishRoll(
                    results.rollId,
                    {
                        roll: total
                    }
                );
            });

            console.log("status roll done.");
        });


    }); 

    on("clicked:roll_wealth", (info) => {
        console.log("rolling wealth....");

        getAttrs(["wealth_score", "character_name", "max_hp", "hp_current", "grazed", "flesh_wound", "banged_up", "hurt_bad", "burning_legend"], (values) => {

            const roll = getBackgroundD10s(parseInt(values.wealth_score));

            startRoll(`&{template:trait} {{characterName=${values.character_name}}} {{roll=[[${roll}d10!]]}} {{skillName=Wealth}}`, (results) => {
                const total = results.results.roll.result
    
                finishRoll(
                    results.rollId,
                    {
                        roll: total
                    }
                );
            });

            console.log("wealth roll done.");
        });


    });


    on("clicked:repeating_rotes-lines:roll-rote", (info) => {
        console.log("rolling rote....");

        console.log(info);
        const roteNum = info.sourceAttribute.split("_")[2];

        console.log(roteNum);

        
        const skillIds = [];

        getSectionIDs("skills-lines", function(skillIdArray) {

            const roteAttrNames = buildRoteAttrDependencyNames(skillIdArray);

            console.log(roteAttrNames);

            getAttrs(roteAttrNames, (values) => {

                const valueMap = new Map(Object.entries(values));
                console.log(valueMap);
                //get skill name
                const skillName = valueMap.get(`repeating_rotes-lines_rote_casting_skill`);
                const roteName = valueMap.get(`repeating_rotes-lines_rote_name`) ? valueMap.get(`repeating_rotes-lines_rote_name`) : "Rote";
                const roteDetails = valueMap.get(`repeating_rotes-lines_rote_details`) ? valueMap.get(`repeating_rotes-lines_rote_details`) : "N/A";
                console.log(values.character_name);
                console.log(skillName);

                //SKILL CALC
                const skillId = findSkillInValues(valueMap, skillName, skillIdArray);

                console.log(skillId);
                //TODO: is this always shinpi?
                const traitName = !skillId ? "shinpi" : valueMap.get(`repeating_skills-lines_${skillId}_skill_trait`);

                if(!traitName) traitName = "shinpi";
                //get traitname
                
                //usee traitName to get value of corresponding trait
                console.log(traitName);
                const traitValue = valueMap.get(traitName);

                //parse the trait
                const traitValNum = parseInt(traitValue);

                //calculate d10s
                const traitRoll = getTraitRollD10s(traitValNum);
                

                let roll = `${traitRoll}d10!`;

                console.log(roll);

                //add focus
                
                //If there is no skill id (found skill in skills table), no focus/bonuses to add... Roll and exit.
                if(parseInt(skillId) === 0){
                    roll = applyWounds(roll, values);
                    startRoll(`&{template:rote} {{characterName=${values.character_name}}} {{roll=[[${roll}]]}} {{roteName=${roteName}}} {{tn=${valueMap.get(`repeating_rotes-lines_rote_tn`)}}} {{roteDetails=${roteDetails}}}`, (results) => {
                        const total = results.results.roll.result

                        finishRoll(
                            results.rollId,
                            {
                                roll: total
                            }
                        );
                    });
                    return;
                }


                for(let i = 1; i <= 5; i++){
                    const diceToAdd = valueMap.get(`repeating_skills-lines_${skillId}_skill_focus${i}`);
                    if(diceToAdd) {
                        roll = roll + ' + ' + diceToAdd;
                        console.log(roll);
                    }
                }

                //add mod
                const diceToAdd = valueMap.get(`repeating_skills-lines_${skillId}_skill_mod`);
                if(diceToAdd) {
                    roll = roll + ' + ' + diceToAdd;
                    console.log(roll);
                }


                roll = applyWounds(roll, values);

                console.log(roll);


                //check results and declare hit/miss

                startRoll(`&{template:rote} {{characterName=${values.character_name}}} {{roll=[[${roll}]]}} {{roteName=${roteName}}} {{tn=${valueMap.get(`repeating_rotes-lines_rote_tn`)}}} {{roteDetails=${valueMap.get(`repeating_rotes-lines_rote_details`)}}}`, (results) => {
                    const total = results.results.roll.result

                    finishRoll(
                        results.rollId,
                        {
                            roll: total
                        }
                    );
                });

                console.log("rote roll done.");

            });

        });

    });

    on("clicked:repeating_custskills-lines:roll-custskill", (info) => {
        console.log("rolling skill....");
        console.log(info);

        const skillId = info.sourceAttribute.split("_")[2];

        console.log(skillId);

        getAttrs([`repeating_custskills-lines_skill_trait`, `repeating_custskills-lines_skill_name`, "character_name",
        `repeating_custskills-lines_skill_focus1`, `repeating_custskills-lines_skill_focus2`, `repeating_custskills-lines_skill_focus3`, `repeating_custskills-lines_skill_focus4`, `repeating_custskills-lines_skill_focus5`, 
        `repeating_custskills-lines_skill_mod`, "power", "reflex", "heart", "savvy", "presence", "perception", "shinpi", 
        "max_hp", "hp_current", "grazed", "flesh_wound", "banged_up", "hurt_bad", "burning_legend"], (values) => {


            const valueMap = new Map(Object.entries(values));
            console.log(valueMap);
            //error check
            if(!valueMap.get(`repeating_custskills-lines_skill_trait`) === null) return;

            //get traitname
            const traitName = valueMap.get(`repeating_custskills-lines_skill_trait`);
            console.log(traitName);
            //use traitName to get value of corresponding trait
            const traitValue = valueMap.get(traitName);
            console.log(traitValue);
            //parse the trait
            const traitValNum = traitValue ? parseInt(traitValue) : 0;
            //calculate d10s
            const traitRoll = getTraitRollD10s(traitValNum);

            let roll = `${traitRoll}d10!`;

            console.log(roll);

            //add focus
            for(let i = 1; i <= 5; i++){
                const diceToAdd = valueMap.get(`repeating_custskills-lines_skill_focus${i}`);
                if(diceToAdd) {
                    roll = roll + ' + ' + diceToAdd;
                    console.log(roll);
                }
            }

            //add mod
            const diceToAdd = valueMap.get(`repeating_custskills-lines_skill_mod`);
            if(diceToAdd) {
                roll = roll + ' + ' + diceToAdd;
            }


            roll = applyWounds(roll, values);

            console.log(roll);

            const skillName = valueMap.get(`repeating_custskills-lines_skill_name`);
            console.log(skillName);
            startRoll(`&{template:skill} {{characterName=${values.character_name}}} {{roll=[[${roll}]]}} {{skillName=${skillName.replaceAll("_", " ")}}}`, (results) => {
                const total = results.results.roll.result
    
                finishRoll(
                    results.rollId,
                    {
                        roll: total
                    }
                );
            });


            console.log("custom skill roll done.");
        });
    });

    on("clicked:repeating_skills-lines:roll-skill", (info) => {
        console.log("rolling skill....");
        console.log(info);

        const skillId = info.sourceAttribute.split("_")[2];

        console.log(skillId);

        getAttrs([`repeating_skills-lines_skill_trait`, `repeating_skills-lines_skill_name`, "character_name",
        `repeating_skills-lines_skill_focus1`, `repeating_skills-lines_skill_focus2`, `repeating_skills-lines_skill_focus3`, `repeating_skills-lines_skill_focus4`, `repeating_skills-lines_skill_focus5`, 
        `repeating_skills-lines_skill_mod`, "power", "reflex", "heart", "savvy", "presence", "perception", "shinpi", 
        "max_hp", "hp_current", "grazed", "flesh_wound", "banged_up", "hurt_bad", "burning_legend"], (values) => {


            const valueMap = new Map(Object.entries(values));
            console.log(valueMap);
            //error check
            if(!valueMap.get(`repeating_skills-lines_skill_trait`) === null) return;

            //get traitname
            const traitName = valueMap.get(`repeating_skills-lines_skill_trait`);
            console.log(traitName);
            //use traitName to get value of corresponding trait
            const traitValue = valueMap.get(traitName);
            console.log(traitValue);
            //parse the trait
            const traitValNum = traitValue ? parseInt(traitValue) : 0;
            //calculate d10s
            const traitRoll = getTraitRollD10s(traitValNum);

            let roll = `${traitRoll}d10!`;

            console.log(roll);

            //add focus
            for(let i = 1; i <= 5; i++){
                const diceToAdd = valueMap.get(`repeating_skills-lines_skill_focus${i}`);
                if(diceToAdd) {
                    roll = roll + ' + ' + diceToAdd;
                    console.log(roll);
                }
            }

            //add mod
            const diceToAdd = valueMap.get(`repeating_skills-lines_skill_mod`);
            if(diceToAdd) {
                roll = roll + ' + ' + diceToAdd;
            }


            roll = applyWounds(roll, values);

            console.log(roll);

            const skillName = valueMap.get(`repeating_skills-lines_skill_name`);

            startRoll(`&{template:skill} {{characterName=${values.character_name}}} {{roll=[[${roll}]]}} {{skillName=${skillName.replaceAll("_", " ")}}}`, (results) => {
                const total = results.results.roll.result
    
                finishRoll(
                    results.rollId,
                    {
                        roll: total
                    }
                );
            });


            console.log("skill roll done.");
        });
    });

    on("clicked:roll_power", (info) => {
        console.log("POWAAAAAAA! -LeMillion");
        console.log("rolling power....");
        getAttrs(["power", "character_name", "max_hp", "hp_current", "grazed", "flesh_wound", "banged_up", "hurt_bad", "burning_legend"], (values) => {

            //if either value is not populated, do nothing.
            if(!values.power) return;

            const power = parseInt(values.power);
            const charName = !values.character_name ? "" : values.character_name;

            //if either value is NaN, return
            if(power === NaN) return;
            
            const d10s = getTraitRollD10s(power);

            let roll = `${d10s}d10!`;

            roll = applyWounds(roll, values);

            startRoll(`&{template:trait} {{characterName=${charName}}} {{traitName=Power}} {{roll=[[${roll}]]}}`, (results) => {
                const total = results.results.roll.result

    
                finishRoll(
                    results.rollId,
                    {
                        roll: total
                    }
                );
            });

        });
        console.log("power roll done.");
    });

    on("clicked:roll_reflex", (info) => {

        console.log("rolling reflex....");
        getAttrs(["reflex", "character_name", "max_hp", "hp_current", "grazed", "flesh_wound", "banged_up", "hurt_bad", "burning_legend"], (values) => {

            //if either value is not populated, do nothing.
            if(!values.reflex) return;

            const reflex = parseInt(values.reflex);
            const charName = !values.character_name ? "" : values.character_name;

            //if either value is NaN, return
            if(reflex === NaN) return;
            
            const d10s = getTraitRollD10s(reflex);

            let roll = `${d10s}d10!`;

            roll = applyWounds(roll, values);

            startRoll(`&{template:trait} {{characterName=${charName}}} {{traitName=Reflex}} {{roll=[[${roll}]]}}`, (results) => {
                const total = results.results.roll.result

    
                finishRoll(
                    results.rollId,
                    {
                        roll: total
                    }
                );
            });

        });
        console.log("reflex roll done.");
    });

    on("clicked:roll_heart", (info) => {

        console.log("rolling heart....");
        getAttrs(["heart", "character_name", "max_hp", "hp_current", "grazed", "flesh_wound", "banged_up", "hurt_bad", "burning_legend"], (values) => {

            //if either value is not populated, do nothing.
            if(!values.heart) return;

            const heart = parseInt(values.heart);
            const charName = !values.character_name ? "" : values.character_name;

            //if either value is NaN, return
            if(heart === NaN) return;
            
            const d10s = getTraitRollD10s(heart);

            let roll = `${d10s}d10!`;

            roll = applyWounds(roll, values);

            startRoll(`&{template:trait} {{characterName=${charName}}} {{traitName=Heart}} {{roll=[[${roll}]]}}`, (results) => {
                const total = results.results.roll.result

    
                finishRoll(
                    results.rollId,
                    {
                        roll: total
                    }
                );
            });

        });
        console.log("heart roll done.");
    });


    on("clicked:roll_savvy", (info) => {

        console.log("rolling savvy....");
        getAttrs(["savvy", "max_hp", "hp_current", "grazed", "flesh_wound", "banged_up", "hurt_bad", "burning_legend", "character_name"], (values) => {

            //if either value is not populated, do nothing.
            if(!values.savvy) return;

            const savvy = parseInt(values.savvy);
            const charName = !values.character_name ? "" : values.character_name;

            //if either value is NaN, return
            if(savvy === NaN) return;
            
            const d10s = getTraitRollD10s(savvy);

            let roll = `${d10s}d10!`;

            roll = applyWounds(roll, values);

            startRoll(`&{template:trait} {{characterName=${charName}}} {{traitName=Savvy}} {{roll=[[${roll}]]}}`, (results) => {
                const total = results.results.roll.result

    
                finishRoll(
                    results.rollId,
                    {
                        roll: total
                    }
                );
            });

        });
        console.log("savvy roll done.");
    });

    on("clicked:roll_presence", (info) => {

        console.log("rolling presence....");
        getAttrs(["presence", "max_hp", "hp_current", "grazed", "flesh_wound", "banged_up", "hurt_bad", "burning_legend", "character_name"], (values) => {

            //if either value is not populated, do nothing.
            if(!values.presence) return;

            const presence = parseInt(values.presence);
            const charName = !values.character_name ? "" : values.character_name;

            //if either value is NaN, return
            if(presence === NaN) return;
            
            const d10s = getTraitRollD10s(presence);

            let roll = `${d10s}d10!`;

            roll = applyWounds(roll, values);

            startRoll(`&{template:trait} {{characterName=${charName}}} {{traitName=Presence}} {{roll=[[${roll}]]}}`, (results) => {
                const total = results.results.roll.result

    
                finishRoll(
                    results.rollId,
                    {
                        roll: total
                    }
                );
            });

        });
        console.log("presence roll done.");
    });

    on("clicked:roll_perception", (info) => {

        console.log("rolling perception....");
        getAttrs(["perception", "character_name", "max_hp", "hp_current", "grazed", "flesh_wound", "banged_up", "hurt_bad", "burning_legend"], (values) => {

            //if either value is not populated, do nothing.
            if(!values.perception) return;

            const perception = parseInt(values.perception);
            const charName = !values.character_name ? "" : values.character_name;

            //if either value is NaN, return
            if(perception === NaN) return;
            
            const d10s = getTraitRollD10s(perception);

            let roll = `${d10s}d10!`;

            roll = applyWounds(roll, values);

            startRoll(`&{template:trait} {{characterName=${charName}}} {{traitName=Perception}} {{roll=[[${roll}]]}}`, (results) => {
                const total = results.results.roll.result

    
                finishRoll(
                    results.rollId,
                    {
                        roll: total
                    }
                );
            });

        });
        console.log("perception roll done.");
    });

    on("clicked:roll_shinpi", (info) => {

        console.log("rolling shinpi....");
        getAttrs(["shinpi", "max_hp", "hp_current", "grazed", "flesh_wound", "banged_up", "hurt_bad", "burning_legend", "character_name"], (values) => {

            //if either value is not populated, do nothing.
            if(!values.shinpi) return;

            const shinpi = parseInt(values.shinpi);
            const charName = !values.character_name ? "" : values.character_name;

            //if either value is NaN, return
            if(shinpi === NaN) return;
            
            const d10s = getTraitRollD10s(shinpi);
            console.log(d10s);

            let roll = `${d10s}d10!`;

            roll = applyWounds(roll, values);

            startRoll(`&{template:trait} {{characterName=${charName}}} {{traitName=Shinpi}} {{roll=[[${roll}]]}}`, (results) => {
                const total = results.results.roll.result

    
                finishRoll(
                    results.rollId,
                    {
                        roll: total
                    }
                );
            });

        });
        console.log("shinpi roll done.");
    });

    ///BUTTON CLICKS - END


    ///AUTOMATIC VALUE ADJUSTMENTS

    on("change:heart", () => {
        calcMaxHp();
        calcMove();
        calcResolve();
    });

    on("change:hp_multiplier", () => {
        calcMaxHp();
    });

    on("change:presence", () => {
        calcResolve();
    });

    on("change:reflex", () => {
        calcMove();
        calcDefence();
    });

    on("change:savvy", () => {
        calcInitiative();
    });

    on("change:power", () => {
        calcDefence();
    });

    ///AUTOMATIC VALUE ADJUSTMENTS - END


    ///UTIL FNS

    const calcMaxHp = () => {
        console.log("calculating max HP....");
        getAttrs(["heart", "hp_multiplier"], (values) => {

            //if either value is not populated, do nothing.
            if(!values.heart || !values.hp_multiplier) return;

            const heart = parseInt(values.heart);
            const hp_multiplier = parseFloat(values.hp_multiplier);

            //if either value is NaN, return
            if(heart === NaN || hp_multiplier === NaN) return;
            

            const max_hp = roundUp(heart * hp_multiplier);

            setAttrs({
                "max_hp": max_hp,
                "grazed": Math.floor(max_hp * 0.9),
                "flesh_wound": Math.floor(max_hp * 0.75),
                "banged_up": Math.floor(max_hp * 0.25),
                "hurt_bad": Math.floor(max_hp * 0.1)
            });

        });
        console.log("max HP calculation done.");
    }

    const calcResolve = () => {
        console.log("calculating resolve....");
        getAttrs(["heart", "presence"], (values) => {

            //if either value is not populated, do nothing.
            if(!values.heart || !values.presence) return;

            const heart = parseInt(values.heart);
            const presence = parseInt(values.presence);

            //if either value is NaN, return
            if(heart === NaN || presence === NaN) return;
            

            const resolve = roundUp((heart + presence) * 0.4);

            setAttrs({
                "resolve_base": resolve
            });

        });
        console.log("resolve calculation done.");
    }

    const calcInitiative = () => {
        console.log("calculating initiative....");
        getAttrs(["reflex", "savvy"], (values) => {

            //if either value is not populated, do nothing.
            if(!values.reflex || !values.savvy) return;

            const reflex = parseInt(values.reflex);
            const savvy = parseInt(values.savvy);

            //if either value is NaN, return
            if(reflex === NaN || savvy === NaN) return;
            

            const initiative = roundUp(reflex + savvy);

            setAttrs({
                "initiative_base": initiative
            });

        });
        console.log("initiative calculation done.");
    }

    const calcDefence = () => {
        console.log("calculating defence....");
        getAttrs(["power", "reflex"], (values) => {

            //if either value is not populated, do nothing.
            if(!values.reflex || !values.power) return;

            const reflex = parseInt(values.reflex);
            const power = parseInt(values.power);

            //if either value is NaN, return
            if(reflex === NaN || power === NaN) return;

            const defence = roundUp((reflex + power) * 0.4);

            setAttrs({
                "defence_base": defence
            });

        });
        console.log("defence calculation done.");
    }

    const calcMove = () => {
        console.log("calculating move....");
        getAttrs(["reflex", "heart", "size"], (values) => {

            //if either value is not populated, do nothing.
            if(!values.heart || !values.reflex || !values.size) return;

            const reflex = parseInt(values.reflex);
            const heart = parseInt(values.heart);
            const size = parseInt(values.size);

            //if either value is NaN, return
            if(heart === NaN || reflex === NaN || size === NaN) return;            

            const move = roundUp((reflex + heart) / size);

            setAttrs({
                "move_base": move
            });

        });
        console.log("move calculation done.");
    }

    //TODO - Extend prototype?
    const roundUp = (float) => {
        return Math.ceil(float);
    }

    const getTraitRollD10s = (score) => {
        if (score < 10) return 1;
        return Math.floor(score / 10);
    }


        const getFateAttrArray = (fateLineIds) => {
        const columns = [];
        for(let i = 0; i < fateLineIds.length; i++){
            columns.push(`repeating_fate-lines_${fateLineIds[i]}_minpercent`);
            columns.push(`repeating_fate-lines_${fateLineIds[i]}_maxpercent`);
            columns.push(`repeating_fate-lines_${fateLineIds[i]}_desc`);

        };
            columns.push("max_hp");
            columns.push("hp_current");
            columns.push("grazed");
            columns.push("flesh_wound");
            columns.push("banged_up");
            columns.push("hurt_bad");
            columns.push("burning_legend");
        return columns;
    }

    const getFateEffect = (roll, values) => {

        const effectMap = new Map(Object.entries(values));
        console.log(effectMap);

        var fateIds = getSectionIdsFromPrefix(effectMap, "repeating_fate-lines");
        console.log(fateIds);

        for (let i = 0; i < fateIds.length; i++){
            if(parseInt(effectMap.get(`repeating_fate-lines_${fateIds[i]}_minpercent`)) !== NaN && 
            parseInt(effectMap.get(`repeating_fate-lines_${fateIds[i]}_maxpercent`)) !== NaN &&
            effectMap.get(`repeating_fate-lines_${fateIds[i]}_desc`) &&
            parseInt(effectMap.get(`repeating_fate-lines_${fateIds[i]}_minpercent`)) <= roll &&
            parseInt(effectMap.get(`repeating_fate-lines_${fateIds[i]}_maxpercent`)) >= roll)

            return effectMap.get(`repeating_fate-lines_${fateIds[i]}_desc`);

        }

        return "None";
    }

    const getSkillValue = (skillNum) => {
        return document.getElementById(`skill${skillNum}_trait`).value;
    }

    const buildTraitMap = (values) => {
        const traits = new Map();
        traits.set("heart", values.heart);
        traits.set("power", values.power);
        traits.set("reflex", values.reflex);
        traits.set("savvy", values.savvy);
        traits.set("presence", values.presence);
        traits.set("shinpi", values.shinpi);
        traits.set("", 0)
        return traits;
    }

    const buildRoteAttrDependencyNames = (skillIdArray) => {
        const skillAttrNames = [];
        for(var i=0; i < skillIdArray.length; i++) {
            skillAttrNames.push(`repeating_skills-lines_${skillIdArray[i]}_skill_trait`);
            skillAttrNames.push(`repeating_skills-lines_${skillIdArray[i]}_skill_name`);
            skillAttrNames.push(`repeating_skills-lines_${skillIdArray[i]}_skill_focus1`);
            skillAttrNames.push(`repeating_skills-lines_${skillIdArray[i]}_skill_focus2`);
            skillAttrNames.push(`repeating_skills-lines_${skillIdArray[i]}_skill_focus3`);
            skillAttrNames.push(`repeating_skills-lines_${skillIdArray[i]}_skill_focus4`);
            skillAttrNames.push(`repeating_skills-lines_${skillIdArray[i]}_skill_focus5`);
            skillAttrNames.push(`repeating_skills-lines_${skillIdArray[i]}_skill_mod`);
            skillAttrNames.push(`repeating_skills-lines_${skillIdArray[i]}_skill_trait`);
        }
        skillAttrNames.push("power");
        skillAttrNames.push(`reflex`);
        skillAttrNames.push(`heart`);
        skillAttrNames.push(`savvy`);
        skillAttrNames.push(`presence`);
        skillAttrNames.push(`perception`);
        skillAttrNames.push(`shinpi`);
        skillAttrNames.push(`character_name`);
        skillAttrNames.push(`repeating_rotes-lines_rote_name`);
        skillAttrNames.push(`repeating_rotes-lines_rote_tn`);
        skillAttrNames.push(`repeating_rotes-lines_rote_casting_skill`);
        skillAttrNames.push(`repeating_rotes-lines_rote_details`);
        skillAttrNames.push("max_hp");
        skillAttrNames.push("hp_current");
        skillAttrNames.push("grazed");
        skillAttrNames.push("flesh_wound");
        skillAttrNames.push("banged_up");
        skillAttrNames.push("hurt_bad");
        skillAttrNames.push("burning_legend");

        return skillAttrNames;
    }


    const buildAttackAttrDependencyNames = (skillIdArray) => {
        const skillAttrNames = [];

        for(var i=0; i < skillIdArray.length; i++) {
            skillAttrNames.push(`repeating_skills-lines_${skillIdArray[i]}_skill_trait`);
            skillAttrNames.push(`repeating_skills-lines_${skillIdArray[i]}_skill_name`);
            skillAttrNames.push(`repeating_skills-lines_${skillIdArray[i]}_skill_focus1`);
            skillAttrNames.push(`repeating_skills-lines_${skillIdArray[i]}_skill_focus2`);
            skillAttrNames.push(`repeating_skills-lines_${skillIdArray[i]}_skill_focus3`);
            skillAttrNames.push(`repeating_skills-lines_${skillIdArray[i]}_skill_focus4`);
            skillAttrNames.push(`repeating_skills-lines_${skillIdArray[i]}_skill_focus5`);
            skillAttrNames.push(`repeating_skills-lines_${skillIdArray[i]}_skill_mod`);
            skillAttrNames.push(`repeating_skills-lines_${skillIdArray[i]}_skill_trait`);
        }
        skillAttrNames.push(`repeating_skills-lines_trait`);
        skillAttrNames.push("power");
        skillAttrNames.push(`reflex`);
        skillAttrNames.push(`heart`);
        skillAttrNames.push(`savvy`);
        skillAttrNames.push(`presence`);
        skillAttrNames.push(`perception`);
        skillAttrNames.push(`shinpi`);
        skillAttrNames.push(`character_name`);
        skillAttrNames.push("max_hp");
        skillAttrNames.push("hp_current");
        skillAttrNames.push("grazed");
        skillAttrNames.push("flesh_wound");
        skillAttrNames.push("banged_up");
        skillAttrNames.push("hurt_bad");
        skillAttrNames.push("burning_legend");
        skillAttrNames.push(`wep_name`);
        skillAttrNames.push(`repeating_equipment-lines_wep_skill_name`);
        skillAttrNames.push(`repeating_equipment-lines_wep_short_range`);
        skillAttrNames.push(`repeating_equipment-lines_wep_long_range`);
        skillAttrNames.push(`repeating_equipment-lines_wep_damage_type`);
        skillAttrNames.push(`repeating_equipment-lines_wep_damage`);
        skillAttrNames.push(`repeating_equipment-lines_wep_burst_roll`);
        skillAttrNames.push(`repeating_equipment-lines_wep_short_modifier`);
        skillAttrNames.push(`repeating_equipment-lines_wep_long_modifier`);
        skillAttrNames.push(`repeating_equipment-lines_wep_attack_bonus`);
        skillAttrNames.push(`repeating_equipment-lines_wep_damage_bonus`);
        skillAttrNames.push(`repeating_equipment-lines_wep_name`);
        skillAttrNames.push(`character_id`);
        skillAttrNames.push(`_reporder_repeating_skills-lines`);

        return skillAttrNames;
    }

    const getSkillDefault = (nameToFind) => {
        const map = new Map();
        map.set("crafting", "heart");
        map.set("meditation", "heart");
        map.set("rally", "heart");
        map.set("survival", "heart");
        map.set("athletics", "power");
        map.set("heavy_melee", "power");
        map.set("light_melee", "power");
        map.set("thrown", "power");
        map.set("unarmed", "power");
        map.set("banter", "reflex");
        map.set("dodge", "reflex");
        map.set("drive", "reflex");
        map.set("sleight_of_hand", "reflex");
        map.set("stealth", "reflex");
        map.set("deception", "presence");
        map.set("eloquence", "presence");
        map.set("intimidation", "presence");
        map.set("performance", "presence");
        map.set("seduction", "presence");
        map.set("archery", "perception");
        map.set("commerce", "perception");
        map.set("gunnery", "perception");
        map.set("intuition", "perception");
        map.set("investigation", "perception");
        map.set("small_arms", "perception");
        map.set("arcana", "savvy");
        map.set("computers", "savvy");
        map.set("gambling", "savvy");
        map.set("hardware", "savvy");
        map.set("medicine", "savvy");
        map.set("security", "savvy");
        map.set("streetwise", "savvy");
        map.set("study", "savvy");
        map.set("surveillance", "savvy");
        map.set("tactics", "savvy");
        map.set("toxicology", "savvy");
        map.set("wetware", "savvy");

        return map.get(nameToFind);
    }


    const findSkillInValues = (valueMap, nameToFind, skillIds) => {
        console.log(nameToFind);
        if(!nameToFind) return null;
        console.log(skillIds);
        const skillValue = skillIds.find(skillId => {
            
            if(valueMap.get(`repeating_skills-lines_${skillId}_skill_name`).toLowerCase() === nameToFind.toLowerCase()) return skillId;
            return false;
        });       

        if(skillValue) return skillValue;

        console.log("Not found, returning default...");
        
        return null;
    }

    const getSkillLineIds = () => {

    }

    const getWoundDeficit = (values) => {
        console.log(values);
        console.log("get wound deficit");
        const currentHp = parseInt(values.hp_current);
        console.log(currentHp);
        if(currentHp >= Math.ceil(parseInt(values.max_hp) * 0.9)){
            return "";
        }
        console.log("deficit found");
        let deficit = 0;
        if(currentHp <= parseInt(values.burning_legend)) return "(-10)";
        if(currentHp <= parseInt(values.hurt_bad)) return "(-7)";
        if(currentHp <= parseInt(values.banged_up)) return "(-5)";
        if(currentHp <= parseInt(values.flesh_wound)) return "(-3)";
        if(currentHp <= parseInt(values.grazed)) return "(-1)";

        return null;

    }

    const applyWounds = (roll, values) => {
        console.log("apply wounds");
        const woundDeficit = getWoundDeficit(values);
        console.log("wound deficit:" + woundDeficit);
        return woundDeficit ? roll + `+ ${woundDeficit}` : roll;
    }

    const getBackgroundD10s = (value) => {

        if(value <= 10) return 1;
        if(value <= 30) return 2;
        if(value <= 65) return 3;
        if(value <= 90) return 4;
        if(value <= 100) return 5;
        
        return 1;
    }

    const getLegendD10s = (value) => {

        if(value <= 45) return 1;
        if(value <= 75) return 2;
        if(value <= 110) return 3;
        if(value <= 160) return 4;
        
        return 5;
    }

    const getKeysWithPrefix = (map, prefix) => {
        const allKeysIterator = map.keys();

        // 2. Convert the iterator to an array
        const allKeysArray = Array.from(allKeysIterator);

        // 3. Filter the keys based on the prefix
        const prefixedKeys = allKeysArray.filter(key => key.startsWith(prefix));

        return prefixedKeys;
    }

    const getSectionIdsFromPrefix = (map, sectionPrefix) => {
        const results = [];

        for (const key of map.keys()) {
            // Check if the key starts with the specified prefix
            if (key.startsWith(sectionPrefix)) {
                // Split the key by underscore
                const parts = key.split('_');
                
                // Ensure the second position (index 1) exists before adding
                if (parts.length > 2) {
                    results.push(parts[2]);
                }
            }
        }

        return [...new Set(results)];
    }


    ///UTIL FNS - END

    //TODO LIST:
    //Combat
    //Equipment/Weapons - damage rolls
    
</script>